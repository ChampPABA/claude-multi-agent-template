# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

---

## [1.2.0] - 2025-01-05

### ⚡ Context Optimization - 70% Token Reduction

**Major Performance Improvement:** Optimized design context loading to reduce token usage from ~20K to ~4.7K tokens while maintaining quality.

### Added

- **STYLE_TOKENS.json** - Lightweight design tokens file (~500 tokens)
  - Auto-generated by `/designsetup` command
  - Contains: colors, spacing, typography, shadows, borders, animations
  - Replaces full STYLE_GUIDE.md for most commands

- **design-context-template.md** - Project design summary template
  - Location: `.claude/templates/design-context-template.md`
  - Generated per project with design system overview
  - ~1K tokens vs ~5K for full style guide

- **document-loader.md** - Unified document loading pattern
  - Location: `.claude/lib/document-loader.md`
  - 3-tier loading strategy (tokens → context → full guide)
  - Pattern A (Planning), Pattern B (Execution), Pattern C (Agents)

### Changed

- **`/designsetup` command** - Now generates both STYLE_GUIDE.md and STYLE_TOKENS.json
  - STEP 5.5: Extract design tokens to JSON
  - Validates JSON before writing
  - Reports both files in final output

- **`/pageplan` command** - Uses STYLE_TOKENS.json instead of full STYLE_GUIDE.md
  - Token usage: ~1.5K (was ~5K)
  - Loads: STYLE_TOKENS.json + validates STYLE_GUIDE.md exists
  - 70% reduction in loading time

- **`/csetup` command** - Validates design system for UI work
  - STEP 2.5: Design System Validation (new)
  - Warns if STYLE_GUIDE.md or STYLE_TOKENS.json missing
  - Adds design info to context.md

- **`/cdev` command** - Sends design reference instead of full content
  - buildAgentPrompt() function added
  - Sends file paths (~200 tokens) instead of content (~5K tokens)
  - Enforces STEP 0.5 design loading for uxui-frontend agent

- **CLAUDE.md** - Updated to v1.2.0 with Context Optimization documentation
  - New section: "Context Optimization (v1.2.0)"
  - Updated Quick Navigation with STYLE_TOKENS.json
  - Token comparison table (before/after)

### Performance

| Metric | Before (v1.1.0) | After (v1.2.0) | Improvement |
|--------|----------------|---------------|-------------|
| **Total tokens** | ~20,000 | ~4,700 | **70% reduction** |
| **Loading speed** | Slow | Fast | **3-4x faster** |
| **/pageplan** | ~5,000 tokens | ~1,500 tokens | **70% faster** |
| **/csetup** | ~5,000 tokens | ~500 tokens | **90% faster** |
| **/cdev** | ~5,000 tokens | ~200 tokens | **96% faster** |
| **uxui-frontend agent** | ~5,000 tokens | ~3,500 tokens | **30% faster** |

### Migration Guide

**For existing projects:**

1. Run `/designsetup` again to generate STYLE_TOKENS.json:
   ```bash
   /designsetup
   ```

2. Verify both files exist:
   ```bash
   ls design-system/STYLE_GUIDE.md
   ls design-system/STYLE_TOKENS.json
   ```

3. Continue normal workflow:
   ```bash
   /psetup
   /csetup feature-name
   /cdev feature-name
   ```

**No breaking changes** - All commands backward compatible!

---

## [1.1.0] - 2024-12-XX

### Added
- TDD classification logic (`.claude/lib/tdd-classifier.md`)
- Agent retry & escalation (`/agent-executor.md`)
- Validation enforcement framework
- Progress tracking protocol (`flags-updater.md`)
- Mandatory agent routing (`agent-router.md`)

### Changed
- `/csetup` now classifies TDD requirements per phase
- `/cdev` implements retry logic (max 2 retries)
- Validation gates enforce pre-work checklists

---

## [1.0.0] - 2024-11-XX

### Initial Release
- 6 specialized agents (integration, uxui-frontend, backend, database, frontend, test-debug)
- `/designsetup` command (auto-generate style guide)
- `/pageplan` command (page planning with component reuse)
- OpenSpec integration (`/csetup`, `/cdev`, `/cview`, `/cstatus`)
- 3-level indexing (project discovery)
- Context7 MCP integration (dynamic best practices)

---

## [Unreleased]

### Planned for 1.3.0
- TaskMaster-style task analysis (subtask breakdown, risk scoring)
- `cak init` smart merge (overwrite templates, keep user files)
- Enhanced `/csetup` with dependency graph and research phases

---

**Legend:**
- `Added` - New features
- `Changed` - Changes in existing functionality
- `Deprecated` - Soon-to-be removed features
- `Removed` - Removed features
- `Fixed` - Bug fixes
- `Security` - Security fixes
